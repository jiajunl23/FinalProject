<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=10"></script>
<script src="https://unpkg.com/tone"></script>
<script>
  /* global nn, Tone */
  
  // The Wandering Pheneoix Element
  
  
  
  
  // Music Element of the Work
  let synth
  let synth2
  let started = false
  let times = 0
  
  function play_stop_music () {
    if (started) {
      Tone.Transport.stop()
      started = false
      this.innerHTML = "Start Playing"
    } else {
      Tone.Transport.start()
      started = true
      this.innerHTML = "Stop Playing"
    }
  }
  
  let possible_notes = ["C3", "D3", "E3"]
  let possible_notes2 = ["F3", "G3", "A3", "B3"]

  function base (time) {
    if (times <= 2) {
      synth.triggerAttackRelease(["A4", "A3"], "4n", time)
      times += 1
    } else if (times <= 4) {
      synth.triggerAttackRelease(["C4", "C3"], "4n", time)
      times += 1
    } else if (times <= 6) {
      synth.triggerAttackRelease(["B4", "B3"], "4n", time)
      times += 1
    } else if (times <= 8) {
      synth.triggerAttackRelease(["A3", "F3"], "4n", time)
      times += 1
    }
    else if (times <= 10) {
      synth.triggerAttackRelease(["C4", "E4"], "4n", time)
      times += 1
    }
    else if (times <= 12) {
      synth.triggerAttackRelease(["D4", "F3"], "4n", time)
      times += 1
    }
    else if (times <= 14) {
      synth.triggerAttackRelease(["E4", "B3"], "4n", time)
      times += 1
    }
    else if (times <= 16) {
      synth.triggerAttackRelease(["C4", "A3"], "4n", time)
      times += 1
    }
    else if (times <= 18) {
      times += 1
    }
    else {
      times = 0
    }
  }
  
  function base2 (time) {
    if (times >= 2 && times % 2 === 0 && times <= 100) {
      const note = possible_notes[nn.randomInt(0, possible_notes.length)]
      synth2.triggerAttackRelease(note, "1n", time)
    }
    
    if (times >= 2 && times % 2 === 1 && times <= 100) {
      const note2 = possible_notes2[nn.randomInt(0, possible_notes2.length)]
      synth2.triggerAttackRelease(note2, "1n", time)
    }
  }
  

  function main () {
    nn.get("body").css({
      backgroundColor: "black",
      backgroundImage: "linear-gradient(110deg, #000 0%, #333 50%, #000 100%)",
      backgroundSize: "800% 100%",
      animation:"slide 4s linear infinite"
      })
    
    nn.create("style").content(`
      @keyframes slide {
        0% {background-position: 0% 0%;}
        100% {background-position: 100% 0%;}
      }
    `).addTo("head")
    
    
    // Music Part of the 
    Tone.Transport.bpm.value = 120
    
    new Tone.Loop(base, '4n').start()
    // new Tone.Loop(base, '8n').start()
    new Tone.Loop(base2, '2n').start()
    
    let play = nn.create("button")
      .content("Start Playing")
      .css({
      borderRadius: "40%",
      width: "100px",
      height: "100px",
      display: "flex",
      position: "absolute",
      alignItems: "center",
      justifyContent: "center",
      fontSize: "20px",
      top: nn.height / 2 - 50,
      left: nn.width / 2 - 50,
      color: "#FFCBA4",
      backgroundColor: "white",
      transition: "all 0.5s"
    })
      .addTo("body")
      
    play.on('click', play_stop_music, play)

    play.on("mouseover", () => {
      play.css({
        backgroundColor: "#FFB6C1",
        color: "yellow",
        width: "120px",
        height: "120px",
        top: nn.height / 2 - 60,
        left: nn.width / 2 - 60
      })
    })

    play.on("mouseout", () => {
      play.css({
        backgroundColor: "white",
        color: "#FFCBA4",
        width: "100px",
        height: "100px",
        top: nn.height / 2 - 50,
        left: nn.width / 2 - 50
      })
    })
    
    const vibrato = new Tone.LFO({
      frequncy: 5,
      min: -15,
      max: 15,
      type: "sine"
    }).start()

    synth = new Tone.PolySynth({
      volume: -10,
      oscillator: {
        type: 'sawtooth'
      },
      envelope: {
        attack: 0.4,
        decay: 0.1,
        sustain: 0.7,
        release: 0.8,
        attackCurve: "sine"
      },
      filter: {
        type: "lowpass",
        frequency: 2000,
        Q: 1
      },
      filterEnvelope: {
        attack: 0.2,
        decay: 0.3,
        sustain: 0.5,
        release: 0.8,
        baseFrequency: 200,
        ocataves: 3
      },
      detune: vibrato
    }).toDestination()
    
    
    const reverb = new Tone.Reverb(2).toDestination()
    synth.connect(reverb)
    
    const vibrato2 = new Tone.LFO({
      frequncy: 5,
      min: -15,
      max: 15,
      type: "sine"
    }).start()
    
    synth2 = new Tone.PolySynth({
      volume: -5,
      oscillator: {
        type: 'sawtooth'
      },
      envelope: {
        attack: 0.7,
        decay: 0.1,
        sustain: 0.8,
        release: 0.9,
        attackCurve: "sine"
      },
      filter: {
        type: "lowpass",
        frequency: 2000,
        Q: 1
      },
      filterEnvelope: {
        attack: 0.2,
        decay: 0.3,
        sustain: 0.5,
        release: 0.8,
        baseFrequency: 200,
        ocataves: 3
      },
      detune: vibrato2
    }).toDestination()
    
    const reverb2 = new Tone.Reverb(2).toDestination()
    synth2.connect(reverb2)

  }

  nn.on('load', main)
</script>